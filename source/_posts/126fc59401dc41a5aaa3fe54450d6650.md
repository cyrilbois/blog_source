---
layout: post
title: 使用 Robocopy 提高 Windows 上拷贝大量文件的体验
abbrlink: 126fc59401dc41a5aaa3fe54450d6650
tags:
  - windows
  - robocopy
categories:
  - 技术杂谈
date: 1680309180000
updated: 1680662640000
---
linux 用久了，我在拷贝大量文件或者镜像某个目录时还是更习惯使用 rsync ，当然 cp 也不是不能用，但有更好的选择的时候，何乐而不为呢？与此同时，我也对 Windows 资源管理器内的复制粘贴功能越发的不爽，这玩意功能单一不说，拷贝大量文件时的体验也很一般，（CMD 里的 COPY 命令也不好使）于是我就开始寻找 Windows 上的相关方案。

我尝试过 rsync 在 windows 上的移植版本 [cwRsync](https://itefix.net/cwrsync)，但不知道是哪里出了问题，cwRsync 的体验很不尽人意，兜兜转转，我最终选择了 WSL1 内的 rsync。后来我又发现了 [FreeFileSync](https://freefilesync.org/) 这个软件，体验也相当不错。

昨天我在逛小众软件论坛时，在某个话题的评论区看到有个用户提了一嘴 Robocopy，他说这个程序比 FreeFileSync 更能满足他的一些需求。我搜索了一下这个程序，发现它竟然是 Windows 内置的！（我 out 了。。。）试了一下，确实很不错，虽然功能还是不如 rsync 等程序强大，但对我目前的需求来讲完全够用了。用下面这行命令就可以快速且方便地把 source 拷贝到 destination。

```bash
robocopy source destination /MIR /MT:32 /V
```

解释一下一些常用参数的含义：

```bash
/MT:32    # 使用 n 个线程进行多线程复制(默认值为 8)。必须至少为 1，但不得大于 128。建议同时使用 /LOG 选项重定向输出以便获得最佳性能。
/ZB       # 使用可重新启动模式。（需要以管理员权限运行）
/COPYALL  # 复制所有文件信息。（需要以管理员权限运行）
/V        # 生成详细输出，同时显示跳过的文件。
/LOG:文件 # 将状态输出到日志文件(覆盖现有日志)。
/E        # 复制子目录，包括空的子目录。
/PURGE    # 删除源中不再存在的目标文件/目录。
/MIR      # 镜像目录树(等同于 /E 加 /PURGE)。
```

可以直接在你的 Windows 终端里执行 `robocopy /?` 命令查看完整文档，或者访问在线文档：[robocopy | Microsoft Learn](https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/robocopy)。

注意：由于 `/PURGE` 参数会**删除**源中不再存在的目标文件/目录，所以在使用这个参数的时候，如果 source 对应的是一个空的目录，你的 destination 目录将会被**清空**！`/MIR` 同理。（rsync 也有这个风险，所以千万要细心啊！）

The End.

---

对了，如果需要断点续传，最好还是用 FreeFileSync，拷贝大量小文件时有没有断点续传都无所谓，但如果其中有动辄几个 G 的大文件，断点续传这个特性还是蛮重要的。
