---
layout: post
title: 管理 Linux 用户配置（点文件）的最好方式
abbrlink: 2ba590febac54e23bd8362760d439a5f
tags:
  - linux
  - dotfiles
categories:
  - 📝技术杂谈
date: 1675693320000
updated: 1675693320000
---
## 前言

作为一个 Linux User，随着时间的推移，我积攒了一大堆自定义的配置文件，每次重装系统或在其他设备初始化工作环境时都要一个一个地拷贝它们，这太不优雅了！我得想个办法优化以下这个过程。经过搜索，我找到了以下几种方式：

1. [【译】使用 GNU stow 管理你的点文件](https://farseerfc.me/zhs/using-gnu-stow-to-manage-your-dotfiles.html)
2. [How to Store Dotfiles - A Bare Git Repository](https://www.atlassian.com/git/tutorials/dotfiles)
3. [chezmoi: Manage your dotfiles across multiple diverse machines, securely.](https://github.com/twpayne/chezmoi)

经过试用/对比，我最终选用了第二个链接内提到的方法，即使用 Bare Git Repository 方式管理。得益于 Git 的强大功能，这种方式主要可以做到以下功能：

* 版本管理
* 监测配置更改
* 多设备同步

这是[我的 dotfiles 仓库](https://github.com/waleslau/dotfiles)，使用方式详见 [README.md](https://github.com/waleslau/dotfiles/blob/main/README.md)，由于下面有更好的方法，此处不再赘述

后来我又发现了一个工具：[yadm](https://github.com/TheLocehiliosan/yadm)，这个工具也是基于 Bare Git Repository 设计的，并且多了[命令补全](https://github.com/TheLocehiliosan/yadm/tree/master/completion)以及配置文件加密等功能。幸运的是，我原来的方法建立的仓库和本工具是完全兼容的

## 安装

可以使用包管理工具安装 `yadm`，如果发行版仓库里没有，也可以直接从 Github 仓库下载（这个东西本质上其实就是一个 shell 脚本）

```bash
mkdir -p ~/.local/bin
curl https://fastly.jsdelivr.net/gh/TheLocehiliosan/yadm@master/yadm -o ~/.local/bin/yadm
chmod +x ~/.local/bin/yadm
```

## 使用

```bash
# 初始化一个新仓库
yadm init

# 克隆现有仓库
yadm clone <url>

# 增添文件/更改
yadm add <important file>
yadm commit

# 加密存储 ssh 密钥，以安全地同步它
echo '.ssh/id_rsa' > ~/.config/yadm/encrypt
yadm encrypt

# 可以在同步本仓库到其他设备后，解密ssh密钥
yadm decrypt

# 为Linux与MacOS创建不同的文件
yadm add path/file.cfg##os.Linux
yadm add path/file.cfg##os.Darwin
```
