---
layout: post
title: 再谈 git 与 ssh 配置
abbrlink: eca39d14dbf84484939d280766dd6681
tags:
  - proxy
  - git
  - ssh
date: 1671342540000
updated: 1671342540000
---

## 说在前面

对于 GitHub，要代理 HTTP 协议的克隆链接，直接执行下面命令（注意代理地址）：

```bash
git config --global http.https://github.com.proxy socks5h://127.0.0.1:7890
# socks5h://表示主机名由 SOCKS 服务器解析
```

下面说一下几种 SSH 协议的克隆链接

## Part1 SSH 协议只改端口不配置代理

```bash
git@github.com:waleslau/dotfiles.git
ssh://git@ssh.github.com:443/waleslau/dotfiles.git
```

后面那种链接就是直接在连接里指定了 ssh 的端口。如果因某些原因无法访问 22 端口，有两个选择，一是使用后面那种链接，二是在 `~/.ssh/config` 内添加如下配置，两种方式是等价的

```bash
Host github.com
        Hostname ssh.github.com
        Port 443
        User git
```

上面配置的内容的意思大概就是当访问 `git@github.com` 时自动翻译成 `git@ssh.github.com:443`

## Part2 SSH 协议加上代理的配置

由于众所周知的原因，只是改到 443 端口可能不够，需要走代理。还是分两种情况讨论：

对于 `git@github.com:waleslau/dotfiles.git` 这样的链接，要让它走代理，需要编辑配置文件 `~/.ssh/config` 添加下面内容

```bash
Host github.com
       User git
       ProxyCommand "C:\Program Files\Git\mingw64\bin\connect.exe" -S 127.0.0.1:7890 %h %p
```

## 以下内容仅作了解

> 写完才发现下面内容其实有点画蛇添足了，既然都用代理了，改不改 443 端口也就无所谓了，对使用者来讲没有任何区别 🤣

如果你想让 `ssh://git@ssh.github.com:443/waleslau/dotfiles.git` 这种风格的链接也走代理的话，需要在 Host 后面加上 `ssh.github.com`。

```bash
Host github.com ssh.github.com
        Hostname ssh.github.com
        Port 443
        User git
        ProxyCommand "C:\Program Files\Git\mingw64\bin\connect.exe" -S 127.0.0.1:7890 %h %p
```

## 更多相关内容

- [给 SSH 设置代理](https://blog.oopsky.top/2022/03/ssh-over-proxy/)
- [突破网络限制访问 GitHub](https://blog.oopsky.top/2022/03/way-to-access-github/)
